#!/bin/sh
#
# mksystem - Adapt system_stm32f4xx.c to our needs
#
# Developed by Werner Almesberger for Actility S.A., and
# licensed under LGPLv2 by Actility S.A.
#

cat <<EOF
/*
 * MACHINE-GENERATED. DO NOT EDIT !
 *
 *
 * Generator:		$0
 * Original file:	$1
 */

EOF

#
# This sets the PLL as follows:
#
# PLL_M = 7	XTAL / PLL_M = VCOin		12 MHz / 7 = 1.7143 MHz
# PLL_N	= 196	VCOin * PLL_N = VCOout		1.7143 MHz * 196 = 336 MHz
# PLL_P = 2	VCCOout / PLL_P = SYSCLK	336 MHz / 2 = 168 MHz
# PLL_Q = 7	VCCout / PLL_Q = 48 MHz clock	336 MHz / 7 = 48 MHz
#

sed -e 's/\(#define PLL_M\).*/\1 7/' \
    -e 's/\(#define PLL_N\).*/\1 196/' \
    -e 's/\(#define PLL_P\).*/\1 2/' \
    -e 's/\(#define PLL_Q\).*/\1 7/' \
    "$1"
